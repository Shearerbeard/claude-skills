# Project Documentation Standards

**Purpose:** Enforce consistent documentation structure and lifecycle management for Claude Code projects.

**Context Window Impact:** ~14KB (~3,500 tokens, <2% of Claude's 200K context)
**Referenced by:** `/consolidate`, `/docs-check`, `/log-session`, `/plan-session`

---

## ğŸ“‹ Documentation Hierarchy

### Root Directory
**Rule:** Root should be clean - use pointer files only

```
/
â”œâ”€â”€ README.md              # Public API documentation
â”œâ”€â”€ TODO.md                # Pointer to docs/TODO.md
â”œâ”€â”€ ARCHITECTURE.md        # Pointer to docs/architecture-decisions.md
â”œâ”€â”€ CONTRIBUTING.md        # Public contribution guide
â””â”€â”€ CHANGELOG.md           # Auto-generated by semantic-release
```

**Never put at root:**
- Session logs
- Planning docs
- Research notes
- Long technical documents

### Documentation Directory Structure

```
docs/
â”œâ”€â”€ TODO.md                              # Master task list
â”œâ”€â”€ architecture-decisions.md            # ADRs (consolidated)
â”œâ”€â”€ technical-achievements.md            # Major milestones
â”‚
â”œâ”€â”€ internal/                            # Developer documentation
â”‚   â”œâ”€â”€ planning/                        # ğŸ”„ Ephemeral planning docs
â”‚   â”‚   â”œâ”€â”€ session-NNN-planning.md      # Session planning (temporary)
â”‚   â”‚   â””â”€â”€ [feature-name]-plan.md       # Feature planning (temporary)
â”‚   â”‚
â”‚   â”œâ”€â”€ research/                        # ğŸ”„ Ephemeral research docs
â”‚   â”‚   â”œâ”€â”€ session-NNN-research.md      # Session research (temporary)
â”‚   â”‚   â””â”€â”€ [topic]-research.md          # Topic research (temporary)
â”‚   â”‚
â”‚   â””â”€â”€ sessions/                        # âœ… Permanent session logs
â”‚       â”œâ”€â”€ README.md                    # Session index
â”‚       â”œâ”€â”€ session-001.md               # First session
â”‚       â”œâ”€â”€ session-002.md               # Second session
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ archive/                             # Historical documentation
    â””â”€â”€ YYYY/                            # Archived by year
        â”œâ”€â”€ session-history-NNN-MMM.md   # Old session batches
        â”œâ”€â”€ [old-planning-doc].md        # Archived planning
        â””â”€â”€ [old-research-doc].md        # Archived research
```

---

## ğŸ”„ Ephemeral Documentation Lifecycle

### When to Create Ephemeral Docs

**Planning docs** (`docs/internal/planning/`):
- Starting a new feature or major refactor
- Exploring architectural approaches
- Breaking down complex work into steps
- Session planning before coding

**Research docs** (`docs/internal/research/`):
- Investigating libraries or patterns
- Performance analysis
- Security research
- Technical spikes

### Naming Convention

**Session-based ephemeral docs:**
```
docs/internal/planning/session-NNN-planning.md
docs/internal/research/session-NNN-research.md
```

**Feature/topic-based ephemeral docs:**
```
docs/internal/planning/oauth-implementation-plan.md
docs/internal/research/zero-copy-parsing-research.md
```

### Lifecycle Stages

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CREATE    â”‚  Start session with planning/research doc
â”‚             â”‚  Reference from session log
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ITERATE   â”‚  Work through doc during session
â”‚             â”‚  Update findings, decisions, approaches
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚ END OF â”‚
   â”‚SESSION â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚
    â”Œâ”€â”€â”´â”€â”€â”€â”
    â”‚      â”‚
    â†“      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ARCHIVE â”‚ â”‚PROMOTE â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**At end of session:**

1. **ARCHIVE** if:
   - Decision made, no longer needed
   - Experiment complete
   - Research concluded
   - Approach abandoned

   â†’ Move to `docs/archive/YYYY/`

2. **PROMOTE** if:
   - Created lasting value
   - Should be permanent reference
   - Became part of codebase design

   â†’ Move to:
   - `docs/architecture-decisions.md` (as ADR)
   - `docs/[feature].md` (as permanent doc)
   - `docs/technical-achievements.md` (as milestone)

3. **KEEP** if:
   - Work in progress (multi-session)
   - Will reference in next session

   â†’ Leave in planning/research, note in session log

### Enforcement in Session Logs

**Session logs MUST document ephemeral doc lifecycle:**

```markdown
## Ephemeral Documentation

**Created:**
- `docs/internal/planning/session-042-oauth-plan.md`

**Status at end of session:**
- âœ… PROMOTED to ADR-018: OAuth Provider Selection
- ğŸ—„ï¸ ARCHIVED to docs/archive/2025/session-042-oauth-plan.md

**Next Session:**
- No ephemeral docs carried forward
```

---

## ğŸ“Š Documentation Types & Locations

### Permanent Documentation

**Location:** `docs/` (root level)

**Types:**
- `TODO.md` - Master task tracking
- `architecture-decisions.md` - All ADRs consolidated
- `technical-achievements.md` - Major milestones
- `[feature].md` - Feature-specific docs
- `KNOWN_ISSUES.md` - Known bugs and workarounds

**Rules:**
- Always referenceable
- Never deleted
- Updated as project evolves
- Organized by topic, not time

### Session Logs

**Location:** `docs/internal/sessions/`

**Rules:**
- One per Claude Code session
- Numbered sequentially (session-001, session-002, ...)
- Created using `/log-session` skill
- Permanent record of work done
- Reference ephemeral docs, decisions, learnings

### Ephemeral Documentation

**Location:** `docs/internal/planning/` or `docs/internal/research/`

**Rules:**
- MUST have lifecycle plan before creating
- MUST be archived or promoted at end of session
- NEVER accumulate indefinitely
- Document status in session log

### Archives

**Location:** `docs/archive/YYYY/`

**Rules:**
- Organized by year
- Include original filename
- Preserve original content (don't edit)
- Reference from session logs if needed

---

## ğŸš¨ Critical Rules

### Rule 1: CLAUDE.md Must Stay Under 500 Lines

**Why:** Large CLAUDE.md files cause:
- Context window bloat
- Difficulty finding information
- Merge conflicts
- Staleness

**How to enforce:**
- Extract session history â†’ `docs/archive/YYYY/`
- Move detailed docs â†’ `docs/[topic].md`
- Use pointers, not full content
- Run `/consolidate` skill regularly

**Check during:**
- End of session
- Before committing
- Weekly maintenance

### Rule 2: No Orphaned Ephemeral Docs

**Problem:** Planning/research docs left behind cause confusion

**Solution:** Every ephemeral doc MUST:
- Be referenced in a session log
- Have clear "Status at end of session" (archived/promoted/kept)
- Be cleaned up within 2 sessions of creation

**Check with:**
```bash
# Find ephemeral docs older than 7 days
find docs/internal/{planning,research} -name "*.md" -mtime +7
```

### Rule 3: Session Logs Reference Ephemeral Docs

**Pattern:**

```markdown
## Related

- Session: session-042.md
- Branch: feature/oauth
- Planning doc: docs/internal/planning/session-042-oauth-plan.md (promoted to ADR-018)
- Research doc: docs/internal/research/oauth-providers.md (archived)
```

This creates audit trail.

### Rule 4: Pointer Files at Root

**Pattern for root TODO.md:**

```markdown
# TODO

**Note:** This project's detailed TODO list is maintained in `docs/TODO.md` (1,573 lines).

See: [docs/TODO.md](docs/TODO.md)
```

**Why:**
- Keeps root clean
- Real file can grow without root clutter
- Clear single source of truth

---

## ğŸ› ï¸ Enforcing These Standards

### 1. Claude Code Guidelines

This file lives at `.claude/guidelines/project-documentation-standards.md`

**Claude will:**
- Automatically follow these rules
- Prompt for lifecycle decisions when creating ephemeral docs
- Check ephemeral doc status at end of session
- Warn if CLAUDE.md exceeds 500 lines

### 2. Session Log Skill

`/log-session` skill enforces:
- Documenting ephemeral docs created
- Recording archive/promote decisions
- Checking for orphaned docs

### 3. Weekly Maintenance

Run these skills:
- `/consolidate` - Clean up documentation structure
- `/docs-check` - Verify consistency

### 4. Pre-commit Hook (Optional)

Add to `.git/hooks/pre-commit`:

```bash
#!/bin/bash

# Check CLAUDE.md size
lines=$(wc -l < CLAUDE.md)
if [ "$lines" -gt 500 ]; then
    echo "âŒ CLAUDE.md is $lines lines (max 500)"
    echo "Run: claude â†’ /consolidate â†’ exit"
    exit 1
fi

# Find old ephemeral docs
old_docs=$(find docs/internal/{planning,research} -name "*.md" -mtime +14 2>/dev/null)
if [ -n "$old_docs" ]; then
    echo "âš ï¸  Found ephemeral docs older than 14 days:"
    echo "$old_docs"
    echo "Archive or promote these before committing"
    exit 1
fi
```

---

## ğŸ“ CLAUDE.md Structure

**Keep CLAUDE.md focused on:**

1. **Current Status** (5-10 lines)
   - What phase are we in?
   - What's the next priority?

2. **Recent Sessions** (last 3-5 sessions, ~50 lines each)
   - Session N: Brief summary
   - Key decisions and learnings
   - Reference to full session log

3. **Project Context** (~100 lines)
   - Quick start commands
   - Project structure
   - Key features
   - Environment setup

4. **Documentation Pointers** (~20 lines)
   - Where to find TODO
   - Where to find architecture docs
   - Where to find session history

**Move to separate docs:**
- Detailed session history â†’ `docs/archive/YYYY/`
- Technical deep dives â†’ `docs/[topic].md`
- Implementation details â†’ `docs/internal/`
- Old decisions â†’ `docs/architecture-decisions.md`

---

## ğŸ¯ Starting a Session with Planning Mode

### Pattern: Session Planning Doc

When starting a complex session, create planning doc first:

```bash
# File: docs/internal/planning/session-042-oauth-plan.md

# OAuth Implementation Plan - Session 042

**Created:** 2025-11-05
**Status:** PLANNING (not yet implemented)

## Goal
Implement OAuth 2.0 authentication with Google and GitHub providers.

## Approach

### Phase 1: Research (1 hour)
- [ ] Compare oauth2 crate vs manual implementation
- [ ] Review provider documentation
- [ ] Identify edge cases

### Phase 2: Implementation (2 hours)
- [ ] Set up oauth2 crate
- [ ] Implement Google provider
- [ ] Implement GitHub provider

### Phase 3: Testing (1 hour)
- [ ] Create mock OAuth server
- [ ] Write integration tests

## Decisions Needed
- Which OAuth library? (oauth2 vs reqwest-oauth)
- How to handle token refresh?
- Where to store user profiles?

## References
- https://docs.rs/oauth2/
- ADR-017: Authentication Strategy

---

**Status at end of session:**
âœ… PROMOTED to ADR-018: OAuth Provider Selection
ğŸ—„ï¸ ARCHIVED to docs/archive/2025/session-042-oauth-plan.md
```

### Pattern: Session Research Doc

For research-heavy sessions:

```bash
# File: docs/internal/research/session-043-zero-copy-parsing.md

# Zero-Copy Parsing Research - Session 043

**Created:** 2025-11-06
**Status:** RESEARCH

## Question
Can we eliminate String allocations in our parser using zero-copy techniques?

## Findings

### Option 1: Use &str instead of String
**Pros:** No allocations
**Cons:** Lifetime complexity
**Performance:** 50% faster in benchmarks

### Option 2: Use Cow<str>
**Pros:** Flexible (borrow or own)
**Cons:** Still allocates when needed
**Performance:** 30% faster

### Option 3: Arena allocator
**Pros:** Single allocation
**Cons:** Requires arena lifetime
**Performance:** 40% faster

## Recommendation
Use Option 1 (&str) with lifetime 'input throughout parser.

## Benchmarks
```
test parse_with_string    ... 1,234 ns/iter
test parse_with_str       ...   612 ns/iter  (50% faster)
test parse_with_cow       ...   863 ns/iter  (30% faster)
```

---

**Status at end of session:**
âœ… PROMOTED to docs/zero-copy-parser-design.md
```

---

## ğŸ” Weekly Maintenance Checklist

Run this weekly to keep documentation clean:

```bash
# 1. Check CLAUDE.md size
wc -l CLAUDE.md
# If > 500 lines: run /consolidate

# 2. Find old ephemeral docs
find docs/internal/{planning,research} -name "*.md" -mtime +14

# 3. Archive or promote them
# Move to docs/archive/YYYY/ or promote to permanent docs

# 4. Update session index
# Ensure docs/internal/sessions/README.md is current

# 5. Run documentation skills
claude
/docs-check
/consolidate  # if needed
exit
```

---

## ğŸ“ Examples

### Good: Clean Documentation Structure

```
docs/
â”œâ”€â”€ TODO.md (1,500 lines - real file)
â”œâ”€â”€ architecture-decisions.md (ADR-001 through ADR-020)
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ planning/
â”‚   â”‚   â””â”€â”€ session-098-api-redesign.md (current session)
â”‚   â”œâ”€â”€ research/
â”‚   â”‚   â””â”€â”€ (empty - all archived or promoted)
â”‚   â””â”€â”€ sessions/
â”‚       â”œâ”€â”€ session-001.md through session-097.md
â”‚       â””â”€â”€ session-098.md (current)
â””â”€â”€ archive/
    â””â”€â”€ 2025/
        â”œâ”€â”€ session-history-sessions-01-50.md
        â””â”€â”€ 15 archived research/planning docs
```

### Bad: Messy Documentation Structure

```
docs/
â”œâ”€â”€ TODO.md (20 lines)
â”œâ”€â”€ TODO-REAL.md (500 lines)
â”œâ”€â”€ TODO-2025-10.md (300 lines)
â”œâ”€â”€ oauth-planning.md (orphaned, 3 months old)
â”œâ”€â”€ research-notes.md (orphaned)
â”œâ”€â”€ session-2025-10-15.md
â”œâ”€â”€ session-2025-10-15-afternoon.md
â”œâ”€â”€ session-2025-10-15-evening.md
â”œâ”€â”€ old-session-logs/
â”‚   â””â”€â”€ (100 files, never referenced)
â””â”€â”€ internal/
    â””â”€â”€ (empty)
```

---

## ğŸ“– Related

- **Skills:** `/log-session`, `/consolidate`, `/docs-check`
- **Templates:** `.claude/templates/session-template.md`, `.claude/templates/adr-template.md`
- **CLAUDE.md:** Document structure and lifecycle in project context

---

**Last Updated:** 2025-11-05

**Note:** This is a living document. Update as your documentation practices evolve.
