# Project Documentation Standards

**Purpose:** Enforce consistent documentation structure and lifecycle management for Claude Code projects.

**Context Window Impact:** ~14KB (~3,500 tokens, <2% of Claude's 200K context)
**Referenced by:** `/docs-consolidate`, `/docs-audit`, `/log-session`, `/plan-session`

## When This Applies

Apply these standards when:
- Creating or organizing documentation files
- Starting or ending Claude Code sessions
- CLAUDE.md exceeds 500 lines
- Creating planning or research documents
- User mentions: "documentation structure", "session logs", "CLAUDE.md cleanup", "consolidate docs"

---

## Documentation Hierarchy

### Root Directory
**Rule:** Root should be clean - use pointer files only

```
/
├── README.md              # Public API documentation
├── TODO.md                # Pointer to docs/TODO.md
├── ARCHITECTURE.md        # Pointer to docs/architecture-decisions.md
├── CONTRIBUTING.md        # Public contribution guide
└── CHANGELOG.md           # Auto-generated by semantic-release
```

**Never put at root:**
- Session logs
- Planning docs
- Research notes
- Long technical documents

### Documentation Directory Structure

```
docs/
├── TODO.md                              # Master task list
├── architecture-decisions.md            # ADRs (consolidated)
├── technical-achievements.md            # Major milestones
│
├── internal/                            # Developer documentation
│   ├── planning/                        # Ephemeral planning docs
│   │   ├── session-NNN-planning.md      # Session planning (temporary)
│   │   └── [feature-name]-plan.md       # Feature planning (temporary)
│   │
│   ├── research/                        # Ephemeral research docs
│   │   ├── session-NNN-research.md      # Session research (temporary)
│   │   └── [topic]-research.md          # Topic research (temporary)
│   │
│   └── sessions/                        # Permanent session logs
│       ├── README.md                    # Session index
│       ├── session-001.md               # First session
│       ├── session-002.md               # Second session
│       └── ...
│
└── archive/                             # Historical documentation
    └── YYYY/                            # Archived by year
        ├── session-history-NNN-MMM.md   # Old session batches
        ├── [old-planning-doc].md        # Archived planning
        └── [old-research-doc].md        # Archived research
```

---

## Ephemeral Documentation Lifecycle

### When to Create Ephemeral Docs

**Planning docs** (`docs/internal/planning/`):
- Starting a new feature or major refactor
- Exploring architectural approaches
- Breaking down complex work into steps
- Session planning before coding

**Research docs** (`docs/internal/research/`):
- Investigating libraries or patterns
- Performance analysis
- Security research
- Technical spikes

### Naming Convention

**Session-based ephemeral docs:**
```
docs/internal/planning/session-NNN-planning.md
docs/internal/research/session-NNN-research.md
```

**Feature/topic-based ephemeral docs:**
```
docs/internal/planning/oauth-implementation-plan.md
docs/internal/research/zero-copy-parsing-research.md
```

### Lifecycle Stages

```
┌─────────────┐
│   CREATE    │  Start session with planning/research doc
│             │  Reference from session log
└──────┬──────┘
       │
       ↓
┌─────────────┐
│   ITERATE   │  Work through doc during session
│             │  Update findings, decisions, approaches
└──────┬──────┘
       │
       ↓
   ┌───┴────┐
   │ END OF │
   │SESSION │
   └───┬────┘
       │
    ┌──┴───┐
    │      │
    ↓      ↓
┌────────┐ ┌────────┐
│ARCHIVE │ │PROMOTE │
└────────┘ └────────┘
```

**At end of session:**

1. **ARCHIVE** if:
   - Decision made, no longer needed
   - Experiment complete
   - Research concluded
   - Approach abandoned

   → Move to `docs/archive/YYYY/`

2. **PROMOTE** if:
   - Created lasting value
   - Should be permanent reference
   - Became part of codebase design

   → Move to:
   - `docs/architecture-decisions.md` (as ADR)
   - `docs/[feature].md` (as permanent doc)
   - `docs/technical-achievements.md` (as milestone)

3. **KEEP** if:
   - Work in progress (multi-session)
   - Will reference in next session

   → Leave in planning/research, note in session log

### Enforcement in Session Logs

**Session logs MUST document ephemeral doc lifecycle:**

```markdown
## Ephemeral Documentation

**Created:**
- `docs/internal/planning/session-042-oauth-plan.md`

**Status at end of session:**
- PROMOTED to ADR-018: OAuth Provider Selection
- ARCHIVED to docs/archive/2025/session-042-oauth-plan.md

**Next Session:**
- No ephemeral docs carried forward
```

---

## Documentation Types & Locations

### Permanent Documentation

**Location:** `docs/` (root level)

**Types:**
- `TODO.md` - Master task tracking
- `architecture-decisions.md` - All ADRs consolidated
- `technical-achievements.md` - Major milestones
- `[feature].md` - Feature-specific docs
- `KNOWN_ISSUES.md` - Known bugs and workarounds

**Rules:**
- Always referenceable
- Never deleted
- Updated as project evolves
- Organized by topic, not time

### Session Logs

**Location:** `docs/internal/sessions/`

**Rules:**
- One per Claude Code session
- Numbered sequentially (session-001, session-002, ...)
- Created using `/log-session` skill
- Permanent record of work done
- Reference ephemeral docs, decisions, learnings

### Ephemeral Documentation

**Location:** `docs/internal/planning/` or `docs/internal/research/`

**Rules:**
- MUST have lifecycle plan before creating
- MUST be archived or promoted at end of session
- NEVER accumulate indefinitely
- Document status in session log

### Archives

**Location:** `docs/archive/YYYY/`

**Rules:**
- Organized by year
- Include original filename
- Preserve original content (don't edit)
- Reference from session logs if needed

---

## Critical Rules

### Rule 1: CLAUDE.md Must Stay Under 500 Lines

**Why:** Large CLAUDE.md files cause:
- Context window bloat
- Difficulty finding information
- Merge conflicts
- Staleness

**How to enforce:**
- Extract session history → `docs/archive/YYYY/`
- Move detailed docs → `docs/[topic].md`
- Use pointers, not full content
- Run `/docs-consolidate` skill regularly

**Check during:**
- End of session
- Before committing
- Weekly maintenance

### Rule 2: No Orphaned Ephemeral Docs

**Problem:** Planning/research docs left behind cause confusion

**Solution:** Every ephemeral doc MUST:
- Be referenced in a session log
- Have clear "Status at end of session" (archived/promoted/kept)
- Be cleaned up within 2 sessions of creation

**Check with:**
```bash
# Find ephemeral docs older than 7 days
find docs/internal/{planning,research} -name "*.md" -mtime +7
```

### Rule 3: Session Logs Reference Ephemeral Docs

**Pattern:**

```markdown
## Related

- Session: session-042.md
- Branch: feature/oauth
- Planning doc: docs/internal/planning/session-042-oauth-plan.md (promoted to ADR-018)
- Research doc: docs/internal/research/oauth-providers.md (archived)
```

This creates audit trail.

### Rule 4: Pointer Files at Root

**Pattern for root TODO.md:**

```markdown
# TODO

**Note:** This project's detailed TODO list is maintained in `docs/TODO.md` (1,573 lines).

See: [docs/TODO.md](docs/TODO.md)
```

**Why:**
- Keeps root clean
- Real file can grow without root clutter
- Clear single source of truth

---

## Enforcing These Standards

### 1. Claude Code Guidelines

This file lives at `.claude/guidelines/project-documentation-standards.md`

**Claude will:**
- Automatically follow these rules
- Prompt for lifecycle decisions when creating ephemeral docs
- Check ephemeral doc status at end of session
- Warn if CLAUDE.md exceeds 500 lines

### 2. Session Log Skill

`/log-session` skill enforces:
- Documenting ephemeral docs created
- Recording archive/promote decisions
- Checking for orphaned docs

### 3. Weekly Maintenance

Run these skills:
- `/docs-consolidate` - Clean up documentation structure
- `/docs-audit` - Verify consistency

### 4. Pre-commit Hook (Optional)

Add to `.git/hooks/pre-commit`:

```bash
#!/bin/bash

# Check CLAUDE.md size
lines=$(wc -l < CLAUDE.md)
if [ "$lines" -gt 500 ]; then
    echo "ERROR: CLAUDE.md is $lines lines (max 500)"
    echo "Run: claude → /docs-consolidate → exit"
    exit 1
fi

# Find old ephemeral docs
old_docs=$(find docs/internal/{planning,research} -name "*.md" -mtime +14 2>/dev/null)
if [ -n "$old_docs" ]; then
    echo "⚠️  Found ephemeral docs older than 14 days:"
    echo "$old_docs"
    echo "Archive or promote these before committing"
    exit 1
fi
```

---

## CLAUDE.md Structure

**Keep CLAUDE.md focused on:**

1. **Current Status** (5-10 lines)
   - What phase are we in?
   - What's the next priority?

2. **Recent Sessions** (last 3-5 sessions, ~50 lines each)
   - Session N: Brief summary
   - Key decisions and learnings
   - Reference to full session log

3. **Project Context** (~100 lines)
   - Quick start commands
   - Project structure
   - Key features
   - Environment setup

4. **Documentation Pointers** (~20 lines)
   - Where to find TODO
   - Where to find architecture docs
   - Where to find session history

**Move to separate docs:**
- Detailed session history → `docs/archive/YYYY/`
- Technical deep dives → `docs/[topic].md`
- Implementation details → `docs/internal/`
- Old decisions → `docs/architecture-decisions.md`

---

## Starting a Session with Planning Mode

### Pattern: Session Planning Doc

When starting a complex session, create planning doc first:

```bash
# File: docs/internal/planning/session-042-oauth-plan.md

# OAuth Implementation Plan - Session 042

**Created:** 2025-11-05
**Status:** PLANNING (not yet implemented)

## Goal
Implement OAuth 2.0 authentication with Google and GitHub providers.

## Approach

### Phase 1: Research (1 hour)
- [ ] Compare oauth2 crate vs manual implementation
- [ ] Review provider documentation
- [ ] Identify edge cases

### Phase 2: Implementation (2 hours)
- [ ] Set up oauth2 crate
- [ ] Implement Google provider
- [ ] Implement GitHub provider

### Phase 3: Testing (1 hour)
- [ ] Create mock OAuth server
- [ ] Write integration tests

## Decisions Needed
- Which OAuth library? (oauth2 vs reqwest-oauth)
- How to handle token refresh?
- Where to store user profiles?

## References
- https://docs.rs/oauth2/
- ADR-017: Authentication Strategy

---

**Status at end of session:**
PROMOTED to ADR-018: OAuth Provider Selection
ARCHIVED to docs/archive/2025/session-042-oauth-plan.md
```

### Pattern: Session Research Doc

For research-heavy sessions:

```bash
# File: docs/internal/research/session-043-zero-copy-parsing.md

# Zero-Copy Parsing Research - Session 043

**Created:** 2025-11-06
**Status:** RESEARCH

## Question
Can we eliminate String allocations in our parser using zero-copy techniques?

## Findings

### Option 1: Use &str instead of String
**Pros:** No allocations
**Cons:** Lifetime complexity
**Performance:** 50% faster in benchmarks

### Option 2: Use Cow<str>
**Pros:** Flexible (borrow or own)
**Cons:** Still allocates when needed
**Performance:** 30% faster

### Option 3: Arena allocator
**Pros:** Single allocation
**Cons:** Requires arena lifetime
**Performance:** 40% faster

## Recommendation
Use Option 1 (&str) with lifetime 'input throughout parser.

## Benchmarks
```
test parse_with_string    ... 1,234 ns/iter
test parse_with_str       ...   612 ns/iter  (50% faster)
test parse_with_cow       ...   863 ns/iter  (30% faster)
```

---

**Status at end of session:**
PROMOTED to docs/zero-copy-parser-design.md
```

---

## Weekly Maintenance Checklist

Run this weekly to keep documentation clean:

```bash
# 1. Check CLAUDE.md size
wc -l CLAUDE.md
# If > 500 lines: run /docs-consolidate

# 2. Find old ephemeral docs
find docs/internal/{planning,research} -name "*.md" -mtime +14

# 3. Archive or promote them
# Move to docs/archive/YYYY/ or promote to permanent docs

# 4. Update session index
# Ensure docs/internal/sessions/README.md is current

# 5. Run documentation skills
claude
/docs-audit
/docs-consolidate  # if needed
exit
```

---

## Examples

### Good: Clean Documentation Structure

```
docs/
├── TODO.md (1,500 lines - real file)
├── architecture-decisions.md (ADR-001 through ADR-020)
├── internal/
│   ├── planning/
│   │   └── session-098-api-redesign.md (current session)
│   ├── research/
│   │   └── (empty - all archived or promoted)
│   └── sessions/
│       ├── session-001.md through session-097.md
│       └── session-098.md (current)
└── archive/
    └── 2025/
        ├── session-history-sessions-01-50.md
        └── 15 archived research/planning docs
```

### Bad: Messy Documentation Structure

```
docs/
├── TODO.md (20 lines)
├── TODO-REAL.md (500 lines)
├── TODO-2025-10.md (300 lines)
├── oauth-planning.md (orphaned, 3 months old)
├── research-notes.md (orphaned)
├── session-2025-10-15.md
├── session-2025-10-15-afternoon.md
├── session-2025-10-15-evening.md
├── old-session-logs/
│   └── (100 files, never referenced)
└── internal/
    └── (empty)
```

---

## Related

- **Skills:** `/log-session`, `/docs-consolidate`, `/docs-audit`
- **Templates:** `.claude/templates/session-template.md`, `.claude/templates/adr-template.md`
- **CLAUDE.md:** Document structure and lifecycle in project context

---

**Last Updated:** 2025-12-11

**Note:** This is a living document. Update as your documentation practices evolve.
